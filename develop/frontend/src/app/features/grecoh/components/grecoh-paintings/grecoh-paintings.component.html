<app-nav-bar></app-nav-bar>

<section id="paintings" class="container">
      <div *ngIf="currentLevelEmpty$ | async; else titleLevelNotEmpty" class="row">
        <div class="section-title col">
          <span>GreCoH</span>
          <h2 id="allLevelsCompleted">Has completado todos los niveles</h2>
          <h3>¡Muchas gracias!</h3>

          <h4 *ngIf="currentExperiment$  | async as experimentObservable">{{experimentObservable.final_comment}}</h4>
          <hr>
          <p><a (click)="firstLevel()">Volver al primer nivel</a></p>
        </div>
      </div>

      <ng-template #titleLevelNotEmpty>
        <div class="section-title row">
          <div class="col">
            <span>GreCoH</span>
            <h2>GreCoH - {{currentLevel}}º nivel</h2>
            <p><strong>Selecciona una de las siguientes obras para comenzar</strong></p>

            <div id="collaborator">
              <p>Indica si estás realizando la actividad con algún/a colaborador/a:
              <select [(ngModel)]="selectedCollaboratorID" (ngModelChange)="onCollaboratorChanged($event)">
                <option *ngFor="let collaborator of collaborators"
                        [ngValue]="collaborator.id">{{collaborator.name}}</option>
              </select>
              </p>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col">
            <div id="images" *ngIf="paintings$ | async; else loading">
              <div *ngFor="let painting of paintings$ | async; trackBy: trackByPainting">
                <div class="image">
                  <i *ngIf="painting.scored" class="paintingDone icofont-ui-check"></i>
                  <img [src]="getGrayscaleImage(painting)" alt="Grayscale image of {{painting.title}}"/>
                  <div class="image-info">
                    <h4>{{painting.painter}}</h4>
                    <p>{{painting.title}}</p>
                    <p *ngIf="!painting.scored"><a [routerLink]="['../painting',painting.id]" class="details-link">Comienza</a></p>
                    <p *ngIf="painting.scored"><a [routerLink]="['../statistics',painting.id]" class="details-link">Resultados</a></p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

      <ng-template #loading>
        <div class="jumbotron">
          Cargando datos del servidor ...
        </div>
      </ng-template>

      <div class="row">
        <div id="cambioNivel" class="col" *ngIf="allLevelPaintingsScored$ | async">
          <hr>
          <h2>Nivel completado</h2>
          <form [formGroup]="formUserLevelComments" (ngSubmit)="sendComments()">
            <h3 *ngIf="currentExperiment$  | async as experimentObservable">{{experimentObservable.user_comments_caption}}</h3>
            <textarea required formControlName="comments" placeholder="Obligatorio"></textarea>
            <p>
              <button class="button" type="submit">Envía comentarios</button>
            </p>
          </form>
          <hr>
          <p *ngIf="!isFirstLevel()"><a (click)="prevLevel()">Anterior nivel</a></p>
          <p *ngIf="hasComments"><a (click)="nextLevel()">Siguiente nivel</a></p>
        </div>
      </div>
      </ng-template>
</section>
<app-footer></app-footer>
